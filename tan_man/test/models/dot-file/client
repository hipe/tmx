#!/usr/bin/env ruby -w

# (..)

module Skylab::TanMan::TestSupport

  class Models::Dot_File::Client

    def initialize invo

      @on_event_selectively = -> * sym_a, & ev_p do

        ev = ev_p[]

        if :using_parser_files != ev.terminal_channel_i
          raise ev.to_exception
        end
      end

      @__invocation = invo
    end

    def parse_file input_file_path
      _doc_controller_via_name_value_pair( :input_path, input_file_path ).graph_sexp
    end

    def parse_string input_string
      _doc_controller_via_name_value_pair( :input_string, input_string ).graph_sexp
    end

    def _doc_controller_via_name_value_pair sym, x

      bx = Common_::Box.new

      _asc = Home_::DocumentMagnetics_::CommonAssociations.common_IO_parameters.dereference sym

      _qkn = Common_::Qualified_Knownness[ x, _asc ]

      bx.add sym, _qkn

      Home_::Models_::DotFile::DocumentController_via_Request.call_by do |o|
        o.qualified_knownness_box = bx
        o.invocation = @__invocation
        o.listener = @on_event_selectively
      end
    end
  end
end

if __FILE__ == $PROGRAM_NAME
  ::Skylab::TanMan::TestSupport::Models::DotFile::Client.new( ARGV ).execute
end
